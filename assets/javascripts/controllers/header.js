// Generated by CoffeeScript 1.7.1
(function() {
  define(['c/controllers', 's/notifier', 's/alert-text'], function(controllers) {
    'use strict';
    return controllers.controller('header', [
      '$http', '$rootScope', '$scope', 'notifier', 'Pusher', 'alerttext', '$location', function($http, $rootScope, $scope, notifier, Pusher, alerttext, $location) {
        $rootScope.$watch('currentUser', function(currentUser) {
          var gatewayId;
          if (currentUser !== void 0) {
            gatewayId = currentUser.gateways[0]._id;
            Pusher.subscribe(gatewayId, 'sensorHubEvent', function(e) {
              var eventResolved, level, notificationMsg;
              eventResolved = e.message.sensorEventEnd !== 0;
              level = eventResolved ? 'success' : 'error';
              notificationMsg = alerttext.sensorHubEvent(e.message);
              return notifier[level]('Sensor Event', notificationMsg);
            });
            return Pusher.subscribe(gatewayId, 'gatewayEvent', function(e) {
              var notificationMsg;
              notificationMsg = alerttext.gatewayEvent(e.message);
              return notifier.info('Gateway Event', notificationMsg);
            });
          }
        });
        $scope.isActive = function(link) {
          return $location.path().indexOf(link) === 0;
        };
        return $scope.logout = function() {
          return $http.post('/api/logout', {
            logout: true
          }).then(function() {
            $rootScope.currentUser = void 0;
            return location.href = '/login';
          });
        };
      }
    ]);
  });

}).call(this);
